
# Assessment Service

This service is the main entry point for the application, handling authentication, book searching, and review management. It is part of a microservice architecture and communicates with other services, such as the Reviews service, via a message broker.

## Table of Contents

- [Architecture](#architecture)
- [Authentication](#authentication)
- [Services](#services)
- [API Routes](#api-routes)
  - [Auth](#auth)
  - [Books](#books)
  - [Reviews](#reviews)
- [Getting Started](#getting-started)

## Architecture

This project follows a microservice architecture. The `Assessment` service is responsible for core user-facing functionalities. It communicates with other specialized microservices for specific tasks.

- **Assessment Service**: The main service that handles user authentication, book information, and acts as an API gateway for review-related operations.
- **Reviews Service**: A separate microservice (located in the `reviews` directory) responsible for managing all aspects of reviews.
- **RabbitMQ**: Used as a message broker for asynchronous communication between the `Assessment` service and the `Reviews` service. For example, when a new review is created, the `Assessment` service publishes an event to a RabbitMQ queue, which is then consumed by the `Reviews` service.

## Authentication

Authentication is handled using JSON Web Tokens (JWT). The flow is as follows:

1.  **User Registration & Login**: A user signs up or logs in with their credentials.
2.  **Token Generation**: Upon successful login, the server generates two tokens:
    -   **Access Token**: A short-lived JWT signed with a secret key. It is sent back to the client in the response body.
    -   **Refresh Token**: A long-lived JWT signed with a different secret key. It is sent to the client as an `httpOnly` cookie.
3.  **Authenticated Requests**: For protected routes, the client must include the Access Token in the `Authorization` header as a Bearer Token.
    ```
    Authorization: Bearer <your_access_token>
    ```
4.  **Token Refresh**: When the Access Token expires, the client can use the Refresh Token (sent automatically via the cookie) to request a new pair of access and refresh tokens from the `/auth/refresh` endpoint.

## Services

### Auth Service

-   **Responsibility**: Manages user registration, login, and token refreshing.
-   **Technologies**: `bcryptjs` for password hashing, `jsonwebtoken` for creating and verifying JWTs, and `passport-jwt` for protecting endpoints.

### Books Service

-   **Responsibility**: Fetches book data from the external Open Library API.
-   **Technologies**: `axios` for making HTTP requests to the external API.

### Reviews Service

-   **Responsibility**: Handles the creation and retrieval of book reviews.
-   **Technologies**: Communicates with the `Reviews` microservice via RabbitMQ for creating new reviews. It is expected to fetch review data from the same microservice.

## API Routes

Below is a summary of the available API routes.

---

### Auth

| Method | Endpoint         | Description              | Request Body                               | Responses                                                                                                                            |
| :----- | :--------------- | :----------------------- | :----------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------- |
| `POST` | `/auth/signup`   | Register a new user      | `{ "email": "...", "password": "..." }`    | `201 Created`, `400 Bad Request`                                                                                                     |
| `POST` | `/auth/login`    | Log in an existing user  | `{ "email": "...", "password": "..." }`    | `200 OK` (returns access/refresh tokens), `400 Bad Request`                                                                          |
| `POST` | `/auth/refresh`  | Refresh an access token  | `{ "token": "<refresh_token>" }`           | `200 OK` (returns new access/refresh tokens), `401 Unauthorized`                                                                     |

---

### Books

| Method | Endpoint             | Description                  | Query Params | Responses                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              - `q` (string) | `200 OK` (returns a list of books), `400 Bad Request`, `500 Internal Server Error`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 -
| `GET`  | `/books/{id}/reviews` | Get all reviews for a book | -            | `200 OK` (returns a list of reviews)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -

---

### Reviews

| Method | Endpoint   | Description              | Request Body                                       | Responses                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    -
| :------- | :--------- | :----------------------- | :------------------------------------------------- | :--------------------------------------------------------------------------------- |
| `POST`   | `/reviews` | Create a new review      | `{ "bookId": "...", "rating": "...", "comment": "..." }` | `201 Created`, `400 Bad Request`, `401 Unauthorized`                               |
| `GET`    | `/reviews` | Get all reviews          | -                                                  | `200 OK` (returns a list of all reviews)                                           |

## Getting Started

To get the project running locally, follow these steps:

1.  **Clone the repository**
    ```bash
    git clone https://github.com/Weab69/API-Gateway-for-a-Multi-Service-Bookstore.git
    cd Assessment
    ```

2.  **Install dependencies**
    ```bash
    npm install
    ```

3.  **Set up environment variables**
    Create a `.env` file in the `Assesment` directory and add the following variables:
    ```
    PORT=8000
    MONGO_URI=mongodb+srv://yeabsira:K9Zayy9E8dspcm6j@cluster0.2swd6.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0
    JWT_SECRET=7u33i9olk4ei
    JWT_REFRESH_SECRET=98eoo39wpi3
    RABBITMQ_URL=amqps://svpkllma:rLNbRH3y_6Js59VqQryY9IEzPwOtjc6m@possum.lmq.cloudamqp.com/svpkllma
    ACCESS_TOKEN_EXPIRATION=15m
    REFRESH_TOKEN_EXPIRATION=7d
    ```

4.  **Start the server**
    ```bash
    npm start
    ```

The server will start on the port specified in your `.env` file (default is 8000).
You can view the API documentation at `http://localhost:8000/api-docs`.
